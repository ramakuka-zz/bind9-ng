// Generated by Chef for <%= node['fqdn'] %>
// Local modifications will be overwritten.

//
// Do any local configuration here
//

// Consider adding the 1918 zones here, if they are not used in your
// organization
<%@zones.keys.each do |view| %>
	<% if view != "noview" %>
view "<%= view %>-view" {
	match-clients <% if !node['bind9']['viewacl'][view].nil? %> { <%= node['bind9']['viewacl'][view] %>; }; <% else %>{ <%= view %>; }; <% end %>
	<% end %>
	// Default Zones
	include "<%=node[:bind9][:dir]%>named.conf.default-zones";
//	include "<%=node[:bind9][:dir]%>zones.rfc1918";

		<% @zones[view].keys.each do |type| %>
			<% @zones[view][type].each do |zone,value| %>
	zone "<%= zone %>" IN {
		type <%= type %>;
			<% if zone.include? "arpa" %>
		notify no;
			<% end %>
			<% case type %>
				<% when "master" %>
		file "<%=node[:bind9][:zonedir]%>/<%= zone %><% if view != "noview" %>.<%= view %><% end%>";
				<% if !node['bind9']['keys'][view].nil? %>
		allow-transfer { key <%= "#{view}-key" %>;};
				<% end %>
					<% if !!node[:bind9][:notify][view] %>
		also-notify {<% node[:bind9][:notify][view].each do |addr| %> <%= addr %>; <% end %> };
					<% end %>
				<% when "forward" %>
		forwarders { <%= value %> };
				<% when "slave" %>
		file "<%=node[:bind9][:zonedir]%>/<%= zone %><% if view != "noview" %>.<%= view %><% end%>";
		masters {<%= value %> };
				<% end %>
	};
	<% end %>
		<% end %>
	<% if view != "noview" %>
};
	<% end %>
<% end %>
